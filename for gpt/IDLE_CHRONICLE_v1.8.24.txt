â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IDLE CHRONICLE - FULL REFERENCE v1.8.24
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## OVERVIEW

Idle Chronicle â€” Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞºĞµÑ€-RPG Ğ´Ğ»Ñ Telegram Mini App.
Tech: Next.js 14, TypeScript, Phaser 3, Socket.io, PostgreSQL + Prisma

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CORE LOOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Tap boss â†’ deal damage â†’ earn gold/exp
2. Boss dies â†’ get chest rewards based on rank
3. Open chests â†’ get equipment/consumables
4. Upgrade equipment â†’ deal more damage
5. Repeat

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESOURCES (Zustand store)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Currencies
- gold (ğŸª™) - Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ²Ğ°Ğ»ÑÑ‚Ğ°
- crystals (ğŸ’) - Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼ (ancientCoin Ğ² Ğ‘Ğ”)
- lotteryTickets (ğŸŸï¸) - Ğ´Ğ»Ñ Ğ»Ğ¾Ñ‚ĞµÑ€ĞµĞ¸

### Consumables
- ether (âœ¨) - x2 ÑƒÑ€Ğ¾Ğ½Ğ° Ğ·Ğ° Ñ‚Ğ°Ğ¿
- etherDust (ğŸŒ«ï¸) - ĞºÑ€Ğ°Ñ„Ñ‚Ğ¸Ñ‚ÑÑ Ğ² ether (10:1)
- enchantCharges (âš¡) - Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ·Ğ°Ñ‚Ğ¾Ñ‡ĞºĞ¸
- protectionCharges (ğŸ›¡ï¸) - Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼ĞºĞ¸

### Potions (30-60 ÑĞµĞº ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹)
- potionHaste - +30% attack speed, 30 ÑĞµĞº
- potionAcumen - +50% damage, 30 ÑĞµĞº
- potionLuck - +10% crit chance, 60 ÑĞµĞº

### Keys (Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸)
- keyWooden (ğŸ—ï¸), keyBronze (ğŸ”‘), keySilver (ğŸ”), keyGold (ğŸ”‘)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMBAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Tap Damage
baseDamage = pAtk + random(1-3)
critDamage = baseDamage * 2.0 (if crit)
etherDamage = damage * 2 (if ether enabled)
buffDamage = damage * (1 + acumen_bonus)

### Stamina
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‚Ğ°Ğ¿ Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ 1 stamina
- 0 stamina = exhausted (Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ)
- MaxStamina = 800 + (Ğ¡Ğ¢ĞĞ™-10)*80

### Mana
- Skills Ñ‚Ñ€Ğ°Ñ‚ÑÑ‚ mana
- Regen: 5 MP/sec Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾
- MaxMana = 400 + (Ğ”Ğ£Ğ¥-10)*40

### Skills
| Skill | Damage | Mana | Cooldown |
|-------|--------|------|----------|
| Fireball | 100 + pAtk*3 | 100 | 10s |
| Ice Arrow | 100 + pAtk*3 | 100 | 10s |
| Lightning | 100 + pAtk*3 | 100 | 10s |

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CHESTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

| Type | Duration | Gold | Equip Chance | Scroll Chance |
|------|----------|------|--------------|---------------|
| Wooden | 5 min | 1000 | 55% common | 3% |
| Bronze | 30 min | 2500 | 80% (20% uncommon) | 15% |
| Silver | 4 hr | 7000 | 100% (40% uncommon, 10% rare) | 25% |
| Gold | 8 hr | 20000 | 100% (15% rare, 3% epic) | 45% |

### Keys
- ĞŸĞ¾ĞºÑƒĞ¿Ğ°ÑÑ‚ÑÑ Ğ² Shop Ğ·Ğ° 999ğŸ’ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹
- ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ ÑÑƒĞ½Ğ´ÑƒĞº ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°

### Chest Slots
- ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ: 5 ÑĞ»Ğ¾Ñ‚Ğ¾Ğ², ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼: 10 ÑĞ»Ğ¾Ñ‚Ğ¾Ğ²
- Ğ¦ĞµĞ½Ñ‹: 50, 150, 300, 500, 750, 1000, 1500, 2000, 3000, 5000 ğŸ’

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BOSS REWARDS (Ğ¿Ğ¾ Ñ€Ğ°Ğ½Ğ³Ñƒ Ğ² ÑĞµÑÑĞ¸Ğ¸)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ’ÑĞµ eligible (>30 ÑĞµĞº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸): 2 Wooden Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾

| Rank | Gold | Silver | Bronze | Wooden | Badge |
|------|------|--------|--------|--------|-------|
| 1 | +1 | +2 | +2 | - | Slayer (7d) |
| 2 | +1 | +1 | +2 | - | Elite (7d) |
| 3 | +1 | +1 | +1 | - | Elite (3d) |
| 4-10 | - | +1 | +1 | - | - |
| 11-25 | - | +1 | - | - | - |
| 26-50 | - | - | +1 | +1 | - |
| 51-100 | - | - | +1 | - | - |
| 101+ | - | - | - | - | - |

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ENCHANT SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Mechanics
- +1 enchantCharge = 1 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°
- Ğ£ÑĞ¿ĞµÑ…: +1 ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ·Ğ°Ñ‚Ğ¾Ñ‡ĞºĞ¸ (+3% stats per level)
- ĞĞµÑƒĞ´Ğ°Ñ‡Ğ°: item breaks (8 Ñ‡Ğ°ÑĞ¾Ğ² Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ)
- Protection: Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼ĞºÑƒ

### Restore Costs
| Rarity | Base Cost |
|--------|-----------|
| Common | 10ğŸ’ |
| Uncommon | 25ğŸ’ |
| Rare | 60ğŸ’ |
| Epic | 120ğŸ’ |

Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°: baseCost * (1 + enchantLevel * 0.25)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DAILY TASKS & AP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Daily Tasks (5 Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ñ…)
- Login, Tap 500x, Open 1 chest, Use skill, Upgrade gear

### Grind Tasks (6 rotating)
- Tap 2000x, Earn 5k gold, Open 3 chests, Deal 50k damage, etc.

### Activity Points (AP)
- ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼: 160 AP/Ğ´ĞµĞ½ÑŒ
- Milestones: 30 AP, 60 AP, 100 AP (Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹)

### Check-In
- 14-day streak
- Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹: gold, crystals, chests

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SHOP PRICES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

| Item | Price | Effect |
|------|-------|--------|
| Ether x100 | 200ğŸª™ | x2 damage per tap |
| Potion Haste | 500ğŸª™ | +30% attack speed, 30s |
| Potion Acumen | 500ğŸª™ | +50% damage, 30s |
| Potion Luck | 1000ğŸª™ | +10% crit, 60s |
| Enchant Charge | 3000ğŸª™ | 1 upgrade attempt |
| Any Key | 999ğŸ’ | Instant chest open |
| Protection | 50ğŸ’ | Prevent break on fail |

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EQUIPMENT SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Slots
weapon, helmet, chest, gloves, legs, boots, shield

### Rarities
| Rarity | pAtk (weapon) | pDef (armor) |
|--------|---------------|--------------|
| Common | 8-10 | 1-3 |
| Uncommon | 12-14 | 3-5 |
| Rare | 16-18 | 5-7 |
| Epic | 20-24 | 8-10 |

### Sets
- Ğ’ÑĞµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ°Ñ‚ ÑĞµÑ‚Ñƒ (novice, iron, steel, mithril...)
- 3/7 Ğ±Ğ¾Ğ½ÑƒÑ: +3% P.Atk
- 6/7 Ğ±Ğ¾Ğ½ÑƒÑ: +5% P.Atk, +5% P.Def

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ARCHITECTURE v1.8.24
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Frontend State Management

### Zustand Store (stores/playerStore.ts)
```typescript
interface PlayerResources {
  // Currencies
  gold, crystals, lotteryTickets
  // Crafting
  ether, etherDust, enchantCharges, protectionCharges
  // Potions
  potionHaste, potionAcumen, potionLuck
  // Keys
  keyWooden, keyBronze, keySilver, keyGold
  // Combat (not persisted)
  stamina, maxStamina, mana, maxMana, exhaustedUntil
  // Character
  level, exp, sp, ps, psCap
}

// Actions
setResources(partial)  // Partial update
setFullState(data)     // Full replace
reset()                // Clear on disconnect

// Selectors
useGold(), useCrystals(), useEther(), useKeys(), usePotions()
useIsCacheStale()      // true if lastSync > 5 min ago
```

### Persist Middleware
- localStorage ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
- ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° UI Ğ´Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°
- lastSync timestamp Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ²ĞµĞ¶ĞµÑÑ‚Ğ¸

## Socket Event Flow

### Global Listeners (hooks/useSocketListeners.ts)
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ² PhaserGame
- auth:success â†’ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ Zustand store
- player:state â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑÑ‚ store Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾

### Tab-specific Listeners
- Ğ¢Ğ°Ğ±Ñ‹ ĞĞ• Ğ´ĞµĞ»Ğ°ÑÑ‚ player:get
- Ğ¢Ğ°Ğ±Ñ‹ Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‚ Ğ¸Ğ· Zustand store
- Ğ¢Ğ°Ğ±Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ğµ listeners

## Server (server.js - Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚ ~9000 ÑÑ‚Ñ€Ğ¾Ğº)

### Key Functions
```javascript
buildResourceState(player, fields?)   // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
emitResourceSync(socket, player, fields?)  // Ğ¨Ğ»Ñ‘Ñ‚ player:state
emitCombatState(socket, player)       // Ğ¨Ğ»Ñ‘Ñ‚ stamina/mana
```

### Shared State
- players: Map<odamage, PlayerObject>
- bossState: Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ¾ÑÑ
- sessionLeaderboard: Map<odamage, DamageEntry>
- onlineUsers: Map Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞºĞ¸Ğ½Ğ³Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FILE STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```
apps/web/
  server.js              # Socket.io backend (~9000 ÑÑ‚Ñ€Ğ¾Ğº)
  prisma/schema.prisma   # Database schema
  src/
    components/game/
      PhaserGame.tsx     # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ UI
      constants.ts       # APP_VERSION, icons, skills
      types.ts           # TypeScript types
      hooks/
        useSocketListeners.ts  # Global socket â†’ Zustand
      ui/
        TopHUD.tsx       # Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
        SkillBar.tsx     # Ğ¡ĞºĞ¸Ğ»Ğ»Ñ‹
        DebugOverlay.tsx # Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° (DEV only)
      stores/
        playerStore.ts   # Zustand + persist
        debugStore.ts    # Event logging (DEV)
    components/tabs/
      ShopTab.tsx        # ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ (Zustand)
      TreasuryTab.tsx    # Ğ¡ÑƒĞ½Ğ´ÑƒĞºĞ¸ (Zustand)
      CharacterTab.tsx   # ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ (Zustand)
      LeaderboardTab.tsx # Ğ›Ğ¸Ğ´ĞµÑ€Ğ±Ğ¾Ñ€Ğ´

packages/shared/src/
  data/items.ts          # Ğ‘Ğ°Ğ·Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ² (ITEMS)
  data/sets.ts           # Ğ¡ĞµÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (SETS)
  data/lootTables.ts     # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ñ€Ğ¾Ğ¿Ğ° (CHESTS)
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEBUG (DEV MODE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Debug Overlay (Ctrl+Shift+D)
ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚:
- Connection status, socketId, userId
- Ğ’ÑĞµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¸Ğ· Zustand store
- Last 20 socket events (in/out)
- Listener leak warnings (>2 per event)
- Force Resync ĞºĞ½Ğ¾Ğ¿ĞºĞ°

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SSOT: Ğ‘Ğ” â€” Ğ•Ğ”Ğ˜ĞĞ¡Ğ¢Ğ’Ğ•ĞĞĞ«Ğ™ Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš ĞŸĞ ĞĞ’Ğ”Ğ«
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸:
```javascript
// âŒ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ
player.gold -= cost;
await prisma.user.update({ data: { gold: BigInt(player.gold) } });

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
const updated = await prisma.user.update({
  where: { id: odamage },
  data: { gold: { decrement: BigInt(cost) } },
  select: { gold: true },
});
player.gold = Number(updated.gold); // sync Ğ¿Ğ¾ÑĞ»Ğµ Ğ‘Ğ”
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CHANGELOG v1.8.20 â†’ v1.8.24
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### v1.8.20: Auth resource loading fix
- server.js: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ancientCoin, lotteryTickets, keys, charges Ğ¿Ñ€Ğ¸ auth

### v1.8.21: Zustand Store Integration
- stores/playerStore.ts - Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚ĞµĞ¹Ñ‚ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
- Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ShopTab, TreasuryTab, CharacterTab
- Ğ£Ğ±Ñ€Ğ°Ğ½Ñ‹ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ğµ socket listeners

### v1.8.22: Zustand Persist Middleware
- localStorage ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- lastSync timestamp
- useIsCacheStale() Ñ…ÑƒĞº

### v1.8.23: Debug Overlay
- Ctrl+Shift+D Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸
- Event logging, listener leak warnings
- Force Resync ĞºĞ½Ğ¾Ğ¿ĞºĞ°

### v1.8.24: Server Modules (REVERTED)
- ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ server/state.js Ğ¸ server/utils/emitters.js
- ĞĞ¢ĞšĞĞ¢Ğ˜Ğ›Ğ˜ Ğ¸Ğ·-Ğ·Ğ° ESM/CJS ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ°
- server.js Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚Ğ½Ñ‹Ğ¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
KNOWN ISSUES / TODO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. server.js Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚ (9000+ ÑÑ‚Ñ€Ğ¾Ğº) - split Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½ Ğ¸Ğ·-Ğ·Ğ° ESM/CJS
2. Debug Overlay Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² dev mode
3. Ğ”Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ .cjs Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ESM
