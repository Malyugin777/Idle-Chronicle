═══════════════════════════════════════════════════════════════════════════════
                        LEADERBOARD SYSTEM - Idle Chronicle
═══════════════════════════════════════════════════════════════════════════════

ФАЙЛЫ В ЭТОЙ ПАПКЕ:
- LeaderboardTab.tsx     - React UI компонент (клиент)
- server-leaderboard.js  - Серверная логика (извлечено из server.js)
- LEADERBOARD_README.txt - Этот документ

═══════════════════════════════════════════════════════════════════════════════
                              КАК ВЫГЛЯДИТ
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────┐
│  🏆 Таблица лидеров                                                 │
│  Битва за славу                                                     │
├─────────────────────────────────────────────────────────────────────┤
│  [Текущий босс]  [Предыдущий босс]  [Все время]  ← 3 вкладки       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  👹 Goblin King                                                     │
│  ████████░░░░░░░░░░  45%                                           │
│  450,000 / 1,000,000 HP                                            │
│                                                                     │
│  ┌──────────────────────────────────────────────────┐              │
│  │ 👑 1. Alex         12,500 урона      25%  ⭐🏆   │              │
│  │ 🥈 2. Maria         8,200 урона      16%         │              │
│  │ 🥉 3. Ivan          6,100 урона      12%         │              │
│  │    4. Player123     4,500 урона       9%         │              │
│  │    5. Guest         2,100 урона       4%         │              │
│  └──────────────────────────────────────────────────┘              │
│                                                                     │
│  ⭐ = Final Blow (добил босса)                                      │
│  🏆 = Top Damage (больше всех урона)                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                              КАК РАБОТАЕТ
═══════════════════════════════════════════════════════════════════════════════

1. СТРУКТУРА ДАННЫХ (сервер)
   ─────────────────────────
   sessionLeaderboard = Map<odamage, {
     odamage: number,      // Накопленный урон за сессию
     odamageN: string,     // Имя игрока
     photoUrl: string,     // Аватар Telegram
     isEligible: boolean   // Активен 30+ сек (для наград)
   }>

2. SOCKET СОБЫТИЯ
   ─────────────────

   Клиент → Сервер:
   ├── leaderboard:get           → Запрос текущего топа
   ├── leaderboard:previous:get  → Запрос топа прошлого босса
   └── leaderboard:alltime:get   → Запрос all-time топа

   Сервер → Клиент:
   ├── leaderboard:data          → Текущий топ + HP босса
   ├── leaderboard:previous      → Данные прошлого босса
   ├── leaderboard:alltime       → All-time топ 20
   └── boss:killed               → Результаты убийства босса

3. ПОТОК ДАННЫХ
   ─────────────

   [Игрок тапает]
        ↓
   [tap:batch → сервер]
        ↓
   [sessionLeaderboard.set(odamage, {...})]  ← Обновляем урон
        ↓
   [leaderboard:get каждые 2 сек]
        ↓
   [leaderboard:data → клиент]
        ↓
   [UI обновляется]

4. НАГРАДЫ ПО РАНГУ (TZ Этап 2)
   ─────────────────────────────

   Ранг    │ Wooden │ Bronze │ Silver │ Gold │ Badge
   ────────┼────────┼────────┼────────┼──────┼───────────
   #1      │   2    │   2    │   2    │  1   │ Slayer 7d
   #2      │   2    │   2    │   1    │  1   │ Elite 7d
   #3      │   2    │   1    │   1    │  1   │ Elite 3d
   #4-10   │   2    │   1    │   1    │  -   │ -
   #11-25  │   2    │   -    │   1    │  -   │ -
   #26-50  │   3    │   1    │   -    │  -   │ -
   #51-100 │   2    │   1    │   -    │  -   │ -
   #101+   │   2    │   -    │   -    │  -   │ -

   ⚠️ Нужна активность 30+ секунд (isEligible = true)

5. PERSISTENCE (сохранение)
   ─────────────────────────

   GameState (singleton):
   ├── sessionLeaderboard: JSON[]  ← Текущая сессия
   └── previousBossSession: JSON   ← Прошлый босс

   Сохраняется:
   - Каждые 10 секунд (saveBossState)
   - При убийстве босса
   - При graceful shutdown

6. ALL-TIME LEADERBOARD
   ─────────────────────

   Берётся напрямую из базы:

   SELECT id, firstName, photoUrl, totalDamage, bossesKilled
   FROM User
   ORDER BY totalDamage DESC
   LIMIT 20

═══════════════════════════════════════════════════════════════════════════════
                           КЛЮЧЕВЫЕ МОМЕНТЫ
═══════════════════════════════════════════════════════════════════════════════

• Топ обновляется в реальном времени (каждые 2 сек на клиенте)
• sessionLeaderboard очищается при респавне нового босса
• previousBossSession хранит результаты последнего убитого босса
• isEligible проверяется по activity:ping (30 сек активности)
• Награды создаются как PendingReward → игрок забирает через rewards:claim

═══════════════════════════════════════════════════════════════════════════════
