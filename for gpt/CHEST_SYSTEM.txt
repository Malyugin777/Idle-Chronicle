# CHEST SYSTEM - –°–∏—Å—Ç–µ–º–∞ —Å—É–Ω–¥—É–∫–æ–≤

## –û–ë–ó–û–†

–°—É–Ω–¥—É–∫–∏ ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –∏ –∑–æ–ª–æ—Ç–∞.
–ü–æ–ª—É—á–∞—é—Ç—Å—è –∑–∞ —É–±–∏–π—Å—Ç–≤–æ –±–æ—Å—Å–æ–≤ (–ø–æ —Ä–∞–Ω–≥—É —É—á–∞—Å—Ç–∏—è).
–û—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ —Ç–∞–π–º–µ—Ä—É (–æ—Ç 5 –º–∏–Ω –¥–æ 8 —á–∞—Å–æ–≤).

---

## –¢–ò–ü–´ –°–£–ù–î–£–ö–û–í

| –¢–∏–ø | –ò–∫–æ–Ω–∫–∞ | –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è | –ó–æ–ª–æ—Ç–æ |
|-----|--------|----------------|--------|
| **Wooden** ü™µ | –î–µ—Ä–µ–≤—è–Ω–Ω—ã–π | 5 –º–∏–Ω—É—Ç | 1,000 |
| **Bronze** üü´ | –ë—Ä–æ–Ω–∑–æ–≤—ã–π | 30 –º–∏–Ω—É—Ç | 2,500 |
| **Silver** ü™ô | –°–µ—Ä–µ–±—Ä—è–Ω—ã–π | 4 —á–∞—Å–∞ | 7,000 |
| **Gold** üü® | –ó–æ–ª–æ—Ç–æ–π | 8 —á–∞—Å–æ–≤ | 20,000 |

---

## –®–ê–ù–°–´ –î–†–û–ü–ê

### WOODEN (–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π) ü™µ
```
–ó–æ–ª–æ—Ç–æ: 1,000 (100%)
–ü—Ä–µ–¥–º–µ—Ç: 55% —à–∞–Ω—Å
  ‚îî‚îÄ Common: 93%
  ‚îî‚îÄ Uncommon: 7%
–°–≤–∏—Ç–æ–∫ –∑–∞—Ç–æ—á–∫–∏: 3% (x1)
```

### BRONZE (–ë—Ä–æ–Ω–∑–æ–≤—ã–π) üü´
```
–ó–æ–ª–æ—Ç–æ: 2,500 (100%)
–ü—Ä–µ–¥–º–µ—Ç: 80% —à–∞–Ω—Å
  ‚îî‚îÄ Common: 70%
  ‚îî‚îÄ Uncommon: 27%
  ‚îî‚îÄ Rare: 3%
–°–≤–∏—Ç–æ–∫ –∑–∞—Ç–æ—á–∫–∏: 15% (x1)
```

### SILVER (–°–µ—Ä–µ–±—Ä—è–Ω—ã–π) ü™ô
```
–ó–æ–ª–æ—Ç–æ: 7,000 (100%)
–ü—Ä–µ–¥–º–µ—Ç: 100% —à–∞–Ω—Å
  ‚îî‚îÄ Uncommon: 75%
  ‚îî‚îÄ Rare: 24%
  ‚îî‚îÄ Epic: 1%
–°–≤–∏—Ç–æ–∫ –∑–∞—Ç–æ—á–∫–∏: 25% (x1-2)
```

### GOLD (–ó–æ–ª–æ—Ç–æ–π) üü®
```
–ó–æ–ª–æ—Ç–æ: 20,000 (100%)
–ü—Ä–µ–¥–º–µ—Ç: 100% —à–∞–Ω—Å
  ‚îî‚îÄ Rare: 92%
  ‚îî‚îÄ Epic: 8%
–°–≤–∏—Ç–æ–∫ –∑–∞—Ç–æ—á–∫–∏: 45% (x1-3)
```

---

## –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –°—É–Ω–¥—É–∫ | Gold | Item % | Common | Uncommon | Rare | Epic | Scroll % | Scroll Qty |
|--------|------|--------|--------|----------|------|------|----------|------------|
| Wooden | 1K | 55% | 93% | 7% | - | - | 3% | 1 |
| Bronze | 2.5K | 80% | 70% | 27% | 3% | - | 15% | 1 |
| Silver | 7K | 100% | - | 75% | 24% | 1% | 25% | 1-2 |
| Gold | 20K | 100% | - | - | 92% | 8% | 45% | 1-3 |

---

## –†–ï–î–ö–û–°–¢–¨ –ü–†–ï–î–ú–ï–¢–û–í (Rarity)

| Rarity | –ù–∞–∑–≤–∞–Ω–∏–µ | –¶–≤–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|------|----------|
| **Common** | –û–±—ã—á–Ω—ã–π | –°–µ—Ä—ã–π | –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã |
| **Uncommon** | –ù–µ–æ–±—ã—á–Ω—ã–π | –ó–µ–ª–µ–Ω—ã–π | +10-20% –∫ —Å—Ç–∞—Ç–∞–º |
| **Rare** | –†–µ–¥–∫–∏–π | –°–∏–Ω–∏–π | +20-40% –∫ —Å—Ç–∞—Ç–∞–º |
| **Epic** | –≠–ø–∏—á–µ—Å–∫–∏–π | –§–∏–æ–ª–µ—Ç–æ–≤—ã–π | +40-60% –∫ —Å—Ç–∞—Ç–∞–º |

---

## –ù–ê–ì–†–ê–î–´ –ó–ê –ë–û–°–°–ê (–ø–æ —Ä–∞–Ω–≥—É)

| –†–∞–Ω–≥ | Wooden | Bronze | Silver | Gold | Badge |
|------|--------|--------|--------|------|-------|
| **1** | 2 | 2 | 2 | 1 | Slayer (7–¥) |
| **2** | 2 | 2 | 1 | 1 | Elite (7–¥) |
| **3** | 2 | 1 | 1 | 1 | Elite (3–¥) |
| **4-10** | 2 | 1 | 1 | - | - |
| **11-25** | 2 | - | 1 | - | - |
| **26-50** | 3 | 1 | - | - | - |
| **51-100** | 2 | 1 | - | - | - |
| **101+** | 2 | - | - | - | - |

*–£—Å–ª–æ–≤–∏–µ: 30+ —Å–µ–∫—É–Ω–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –±–æ—Å—Å–∞*

---

## –ê–õ–ì–û–†–ò–¢–ú –ì–ï–ù–ï–†–ê–¶–ò–ò –õ–£–¢–ê

```javascript
function generateChestLoot(chestType) {
  const config = CHESTS[chestType];

  return {
    // –ó–æ–ª–æ—Ç–æ –≤—Å–µ–≥–¥–∞ –≤—ã–ø–∞–¥–∞–µ—Ç
    gold: config.gold,

    // –ü—Ä–µ–¥–º–µ—Ç —Å —à–∞–Ω—Å–æ–º itemChance
    itemRarity: rollItemRarity(chestType),

    // –°–≤–∏—Ç–∫–∏ —Å —à–∞–Ω—Å–æ–º scrollChance
    enchantScrolls: rollEnchantScrolls(chestType),
  };
}

function rollItemRarity(chestType) {
  const config = CHESTS[chestType];

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–Ω—Å–∞ –≤—ã–ø–∞–¥–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞
  if (Math.random() >= config.itemChance) {
    return null; // –ü—Ä–µ–¥–º–µ—Ç –Ω–µ –≤—ã–ø–∞–ª
  }

  // –ü—Ä–µ–¥–º–µ—Ç –≤—ã–ø–∞–ª ‚Äî —Ä–æ–ª–ª–∏–º —Ä–µ–¥–∫–æ—Å—Ç—å –ø–æ –≤–µ—Å–∞–º
  const weights = config.rarityWeights;
  const totalWeight = sum(weights); // 100
  let roll = Math.random() * totalWeight;

  for (const [rarity, weight] of weights) {
    roll -= weight;
    if (roll <= 0) return rarity;
  }
}

function rollEnchantScrolls(chestType) {
  const config = CHESTS[chestType];

  if (Math.random() >= config.scrollChance) {
    return 0;
  }

  const [min, max] = config.scrollQty;
  return randomInt(min, max);
}
```

---

## –ü–†–ò–ú–ï–† –û–¢–ö–†–´–¢–ò–Ø

### Gold Chest:
```
–û—Ç–∫—Ä—ã—Ç–∏–µ: 8 —á–∞—Å–æ–≤
–†–µ–∑—É–ª—å—Ç–∞—Ç:
  ‚úì Gold: +20,000
  ‚úì Item: Epic (8% —à–∞–Ω—Å) –∏–ª–∏ Rare (92%)
  ? Scrolls: 45% —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å 1-3 —Å–≤–∏—Ç–∫–∞

–°—Ä–µ–¥–Ω–∏–π –ª—É—Ç –∑–∞ Gold Chest:
  - 20,000 –∑–æ–ª–æ—Ç–∞ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)
  - 1 Rare/Epic –ø—Ä–µ–¥–º–µ—Ç (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)
  - ~0.9 —Å–≤–∏—Ç–∫–æ–≤ –≤ —Å—Ä–µ–¥–Ω–µ–º (45% * 2)
```

### Wooden Chest:
```
–û—Ç–∫—Ä—ã—Ç–∏–µ: 5 –º–∏–Ω—É—Ç
–†–µ–∑—É–ª—å—Ç–∞—Ç:
  ‚úì Gold: +1,000
  ? Item: 55% —à–∞–Ω—Å (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º Common)
  ? Scrolls: 3% —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å 1 —Å–≤–∏—Ç–æ–∫

–°—Ä–µ–¥–Ω–∏–π –ª—É—Ç –∑–∞ Wooden Chest:
  - 1,000 –∑–æ–ª–æ—Ç–∞ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)
  - ~0.55 –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ —Å—Ä–µ–¥–Ω–µ–º
  - ~0.03 —Å–≤–∏—Ç–∫–∞ –≤ —Å—Ä–µ–¥–Ω–µ–º
```

---

## –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `lootTables.ts` | –ö–æ–Ω—Ñ–∏–≥ –¥—Ä–æ–ø–∞ (CHESTS, RARITY_STYLES) |
| `TreasuryTab.tsx` | UI —Å—É–Ω–¥—É–∫–æ–≤ –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è |
| `server.js` | chest:open –ª–æ–≥–∏–∫–∞ |

---

## –°–•–ï–ú–ê –ë–î

```prisma
model Chest {
  id          String   @id
  odamage     String   // userId
  type        String   // WOODEN, BRONZE, SILVER, GOLD
  createdAt   DateTime
  openAt      DateTime // –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è
  opened      Boolean  @default(false)
  loot        Json?    // —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è
}
```
